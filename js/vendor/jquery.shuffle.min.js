/**
 * @author Glen Cheney
 */

/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);

(function(e){if(typeof define==="function"&&define.amd){define(["jquery","modernizr"],e)}else{window.Shuffle=e(window.jQuery,window.Modernizr)}})(function(e,t,n){"use strict";function r(e){if(!e){return""}return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function y(t,n,r){var i,s,o;var u=null;var a=0;r=r||{};var f=function(){a=r.leading===false?0:e.now();u=null;o=t.apply(i,s);i=s=null};return function(){var l=e.now();if(!a&&r.leading===false){a=l}var c=n-(l-a);i=this;s=arguments;if(c<=0||c>n){clearTimeout(u);u=null;a=l;o=t.apply(i,s);i=s=null}else if(!u&&r.trailing!==false){u=setTimeout(f,c)}return o}}function b(e,t,n){for(var r=0,i=e.length;r<i;r++){if(t.call(n,e[r],r,e)==={}){return}}}function w(t,n,r){return setTimeout(e.proxy(t,n),r)}function E(e){return Math.max.apply(Math,e)}function S(e){return Math.min.apply(Math,e)}function x(t){return e.isNumeric(t)?t:0}function L(e){var t,n;var r=e.length;if(!r){return e}while(--r){n=Math.floor(Math.random()*(r+1));t=e[n];e[n]=e[r];e[r]=t}return e}if(typeof t!=="object"){throw new Error("Shuffle.js requires Modernizr.\n"+"http://vestride.github.io/Shuffle/#dependencies")}var i=t.prefixed("transition");var s=t.prefixed("transitionDelay");var o=t.prefixed("transitionDuration");var u={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[i];var a=t.prefixed("transform");var f=r(a);var l=t.csstransforms&&t.csstransitions;var c=t.csstransforms3d;var h="shuffle";var p=.3;var d="all";var v="groups";var m=1;var g=.001;var T=function(e,t){this.x=x(e);this.y=x(t)};T.equals=function(e,t){return e.x===t.x&&e.y===t.y};var N=0;var C=e(window);var k=function(t,n){n=n||{};e.extend(this,k.options,n,k.settings);this.$el=e(t);this.element=t;this.unique="shuffle_"+N++;this._fire(k.EventType.LOADING);this._init();w(function(){this.initialized=true;this._fire(k.EventType.DONE)},this,16)};k.EventType={LOADING:"loading",DONE:"done",LAYOUT:"layout",REMOVED:"removed"};k.ClassName={BASE:h,SHUFFLE_ITEM:"shuffle-item",FILTERED:"filtered",CONCEALED:"concealed"};k.options={group:d,speed:250,easing:"ease-out",itemSelector:"",sizer:null,gutterWidth:0,columnWidth:0,delimeter:null,buffer:0,initialSort:null,throttle:y,throttleTime:300,sequentialFadeDelay:150,supported:l};k.settings={useSizer:false,itemCss:{position:"absolute",top:0,left:0,visibility:"visible"},revealAppendedDelay:300,lastSort:{},lastFilter:d,enabled:true,destroyed:false,initialized:false,_animations:[],styleQueue:[]};k.Point=T;k._getItemTransformString=function(e,t){if(c){return"translate3d("+e.x+"px, "+e.y+"px, 0) scale3d("+t+", "+t+", 1)"}else{return"translate("+e.x+"px, "+e.y+"px) scale("+t+")"}};k._getNumberStyle=function(t,n){return k._getFloat(e(t).css(n))};k._getInt=function(e){return x(parseInt(e,10))};k._getFloat=function(e){return x(parseFloat(e))};k._getOuterWidth=function(e,t){var n=e.offsetWidth;if(t){var r=k._getNumberStyle(e,"marginLeft");var i=k._getNumberStyle(e,"marginRight");n+=r+i}return n};k._getOuterHeight=function(e,t){var n=e.offsetHeight;if(t){var r=k._getNumberStyle(e,"marginTop");var i=k._getNumberStyle(e,"marginBottom");n+=r+i}return n};k._skipTransition=function(e,t,n){var r=e.style[o];e.style[o]="0ms";t.call(n);var i=e.offsetWidth;i=null;e.style[o]=r};k.prototype._init=function(){this.$items=this._getItems();this.sizer=this._getElementOption(this.sizer);if(this.sizer){this.useSizer=true}this.$el.addClass(k.ClassName.BASE);this._initItems();C.on("resize."+h+"."+this.unique,this._getResizeFunction());var e=this.$el.css(["position","overflow"]);var t=k._getOuterWidth(this.element);this._validateStyles(e);this._setColumns(t);this.shuffle(this.group,this.initialSort);if(this.supported){w(function(){this._setTransitions();this.element.style[i]="height "+this.speed+"ms "+this.easing},this)}};k.prototype._getResizeFunction=function(){var t=e.proxy(this._onResize,this);return this.throttle?this.throttle(t,this.throttleTime):t};k.prototype._getElementOption=function(e){if(typeof e==="string"){return this.$el.find(e)[0]||null}else if(e&&e.nodeType&&e.nodeType===1){return e}else if(e&&e.jquery){return e[0]}return null};k.prototype._validateStyles=function(e){if(e.position==="static"){this.element.style.position="relative"}if(e.overflow!=="hidden"){this.element.style.overflow="hidden"}};k.prototype._filter=function(e,t){e=e||this.lastFilter;t=t||this.$items;var n=this._getFilteredSets(e,t);this._toggleFilterClasses(n.filtered,n.concealed);this.lastFilter=e;if(typeof e==="string"){this.group=e}return n.filtered};k.prototype._getFilteredSets=function(t,n){var r=e();var i=e();if(t===d){r=n}else{b(n,function(n){var s=e(n);if(this._doesPassFilter(t,s)){r=r.add(s)}else{i=i.add(s)}},this)}return{filtered:r,concealed:i}};k.prototype._doesPassFilter=function(t,n){if(e.isFunction(t)){return t.call(n[0],n,this)}else{var r=n.data(v);var i=this.delimeter&&!e.isArray(r)?r.split(this.delimeter):r;return e.inArray(t,i)>-1}};k.prototype._toggleFilterClasses=function(e,t){e.removeClass(k.ClassName.CONCEALED).addClass(k.ClassName.FILTERED);t.removeClass(k.ClassName.FILTERED).addClass(k.ClassName.CONCEALED)};k.prototype._initItems=function(e){e=e||this.$items;e.addClass([k.ClassName.SHUFFLE_ITEM,k.ClassName.FILTERED].join(" "));e.css(this.itemCss).data("point",new T).data("scale",m)};k.prototype._updateItemCount=function(){this.visibleItems=this._getFilteredItems().length};k.prototype._setTransition=function(e){e.style[i]=f+" "+this.speed+"ms "+this.easing+", opacity "+this.speed+"ms "+this.easing};k.prototype._setTransitions=function(e){e=e||this.$items;b(e,function(e){this._setTransition(e)},this)};k.prototype._setSequentialDelay=function(e){if(!this.supported){return}b(e,function(e,t){e.style[s]="0ms,"+(t+1)*this.sequentialFadeDelay+"ms"},this)};k.prototype._getItems=function(){return this.$el.children(this.itemSelector)};k.prototype._getFilteredItems=function(){return this.$items.filter("."+k.ClassName.FILTERED)};k.prototype._getConcealedItems=function(){return this.$items.filter("."+k.ClassName.CONCEALED)};k.prototype._getColumnSize=function(t,n){var r;if(e.isFunction(this.columnWidth)){r=this.columnWidth(t)}else if(this.useSizer){r=k._getOuterWidth(this.sizer)}else if(this.columnWidth){r=this.columnWidth}else if(this.$items.length>0){r=k._getOuterWidth(this.$items[0],true)}else{r=t}if(r===0){r=t}return r+n};k.prototype._getGutterSize=function(t){var n;if(e.isFunction(this.gutterWidth)){n=this.gutterWidth(t)}else if(this.useSizer){n=k._getNumberStyle(this.sizer,"marginLeft")}else{n=this.gutterWidth}return n};k.prototype._setColumns=function(e){var t=e||k._getOuterWidth(this.element);var n=this._getGutterSize(t);var r=this._getColumnSize(t,n);var i=(t+n)/r;if(Math.abs(Math.round(i)-i)<p){i=Math.round(i)}this.cols=Math.max(Math.floor(i),1);this.containerWidth=t;this.colWidth=r};k.prototype._setContainerSize=function(){this.$el.css("height",this._getContainerSize())};k.prototype._getContainerSize=function(){return E(this.positions)};k.prototype._fire=function(e,t){this.$el.trigger(e+"."+h,t&&t.length?t:[this])};k.prototype._resetCols=function(){var e=this.cols;this.positions=[];while(e--){this.positions.push(0)}};k.prototype._layout=function(e,t){b(e,function(e){this._layoutItem(e,!!t)},this);this._processStyleQueue();this._setContainerSize()};k.prototype._layoutItem=function(t,n){var r=e(t);var i=r.data();var s=i.point;var o=i.scale;var u={width:k._getOuterWidth(t,true),height:k._getOuterHeight(t,true)};var a=this._getItemPosition(u);if(T.equals(s,a)&&o===m){return}i.point=a;i.scale=m;this.styleQueue.push({$item:r,point:a,scale:m,opacity:n?0:1,skipTransition:n,callfront:function(){if(!n){r.css("visibility","visible")}},callback:function(){if(n){r.css("visibility","hidden")}}})};k.prototype._getItemPosition=function(e){var t=this._getColumnSpan(e.width,this.colWidth,this.cols);var n=this._getColumnSet(t,this.cols);var r=this._getShortColumn(n,this.buffer);var i=new T(Math.round(this.colWidth*r),Math.round(n[r]));var s=n[r]+e.height;var o=this.cols+1-n.length;for(var u=0;u<o;u++){this.positions[r+u]=s}return i};k.prototype._getColumnSpan=function(e,t,n){var r=e/t;if(Math.abs(Math.round(r)-r)<p){r=Math.round(r)}return Math.min(Math.ceil(r),n)};k.prototype._getColumnSet=function(e,t){if(e===1){return this.positions}else{var n=t+1-e;var r=[];for(var i=0;i<n;i++){r[i]=E(this.positions.slice(i,i+e))}return r}};k.prototype._getShortColumn=function(e,t){var n=S(e);for(var r=0,i=e.length;r<i;r++){if(e[r]>=n-t&&e[r]<=n+t){return r}}return 0};k.prototype._shrink=function(t){var n=t||this._getConcealedItems();b(n,function(t){var n=e(t);var r=n.data();if(r.scale===g){return}r.scale=g;this.styleQueue.push({$item:n,point:r.point,scale:g,opacity:0,callback:function(){n.css("visibility","hidden")}})},this)};k.prototype._onResize=function(){if(!this.enabled||this.destroyed||this.isTransitioning){return}var e=k._getOuterWidth(this.element);if(e===this.containerWidth){return}this.update()};k.prototype._getStylesForTransition=function(e){var t={opacity:e.opacity};if(this.supported){t[a]=k._getItemTransformString(e.point,e.scale)}else{t.left=e.point.x;t.top=e.point.y}return t};k.prototype._transition=function(t){var n=this._getStylesForTransition(t);this._startItemAnimation(t.$item,n,t.callfront||e.noop,t.callback||e.noop)};k.prototype._startItemAnimation=function(t,n,r,i){function s(t){if(t.target===t.currentTarget){e(t.target).off(u,s);i()}}r();if(!this.initialized){t.css(n);i();return}if(this.supported){t.css(n);t.on(u,s)}else{var o=t.stop(true).animate(n,this.speed,"swing",i);this._animations.push(o.promise())}};k.prototype._processStyleQueue=function(t){var n=e();b(this.styleQueue,function(e){if(e.skipTransition){this._styleImmediately(e)}else{n=n.add(e.$item);this._transition(e)}},this);if(n.length>0&&this.initialized){this.isTransitioning=true;if(this.supported){this._whenCollectionDone(n,u,this._movementFinished)}else{this._whenAnimationsDone(this._movementFinished)}}else if(!t){w(this._layoutEnd,this)}this.styleQueue.length=0};k.prototype._styleImmediately=function(e){k._skipTransition(e.$item[0],function(){e.$item.css(this._getStylesForTransition(e))},this)};k.prototype._movementFinished=function(){this.isTransitioning=false;this._layoutEnd()};k.prototype._layoutEnd=function(){this._fire(k.EventType.LAYOUT)};k.prototype._addItems=function(e,t,n){this._initItems(e);this._setTransitions(e);this.$items=this._getItems();this._shrink(e);b(this.styleQueue,function(e){e.skipTransition=true});this._processStyleQueue(true);if(t){this._addItemsToEnd(e,n)}else{this.shuffle(this.lastFilter)}};k.prototype._addItemsToEnd=function(e,t){var n=this._filter(null,e);var r=n.get();this._updateItemCount();this._layout(r,true);if(t&&this.supported){this._setSequentialDelay(r)}this._revealAppended(r)};k.prototype._revealAppended=function(t){w(function(){b(t,function(t){var n=e(t);this._transition({$item:n,opacity:1,point:n.data("point"),scale:m})},this);this._whenCollectionDone(e(t),u,function(){e(t).css(s,"0ms");this._movementFinished()})},this,this.revealAppendedDelay)};k.prototype._whenCollectionDone=function(t,n,r){function u(t){if(t.target===t.currentTarget){e(t.target).off(n,u);i++;if(i===s){r.call(o)}}}var i=0;var s=t.length;var o=this;t.on(n,u)};k.prototype._whenAnimationsDone=function(t){e.when.apply(null,this._animations).always(e.proxy(function(){this._animations.length=0;t.call(this)},this))};k.prototype.shuffle=function(e,t){if(!this.enabled||this.isTransitioning){return}if(!e){e=d}this._filter(e);this._updateItemCount();this._shrink();this.sort(t)};k.prototype.sort=function(e){if(this.enabled&&!this.isTransitioning){this._resetCols();var t=e||this.lastSort;var n=this._getFilteredItems().sorted(t);this._layout(n);this.lastSort=t}};k.prototype.update=function(e){if(this.enabled&&!this.isTransitioning){if(!e){this._setColumns()}this.sort()}};k.prototype.layout=function(){this.update(true)};k.prototype.appended=function(e,t,n){this._addItems(e,t===true,n!==false)};k.prototype.disable=function(){this.enabled=false};k.prototype.enable=function(e){this.enabled=true;if(e!==false){this.update()}};k.prototype.remove=function(t){function n(){t.remove();this.$items=this._getItems();this._updateItemCount();this._fire(k.EventType.REMOVED,[t,this]);t=null}if(!t.length||!t.jquery){return}this._toggleFilterClasses(e(),t);this._shrink(t);this.sort();this.$el.one(k.EventType.LAYOUT+"."+h,e.proxy(n,this))};k.prototype.destroy=function(){C.off("."+this.unique);this.$el.removeClass(h).removeAttr("style").removeData(h);this.$items.removeAttr("style").removeData("point").removeData("scale").removeClass([k.ClassName.CONCEALED,k.ClassName.FILTERED,k.ClassName.SHUFFLE_ITEM].join(" "));this.$items=null;this.$el=null;this.sizer=null;this.element=null;this.destroyed=true};e.fn.shuffle=function(t){var n=Array.prototype.slice.call(arguments,1);return this.each(function(){var r=e(this);var i=r.data(h);if(!i){i=new k(this,t);r.data(h,i)}else if(typeof t==="string"&&i[t]){i[t].apply(i,n)}})};e.fn.sorted=function(t){var r=e.extend({},e.fn.sorted.defaults,t);var i=this.get();var s=false;if(!i.length){return[]}if(r.randomize){return L(i)}if(e.isFunction(r.by)){i.sort(function(t,i){if(s){return 0}var o=r.by(e(t));var u=r.by(e(i));if(o===n&&u===n){s=true;return 0}if(o<u||o==="sortFirst"||u==="sortLast"){return-1}if(o>u||o==="sortLast"||u==="sortFirst"){return 1}return 0})}if(s){return this.get()}if(r.reverse){i.reverse()}return i};e.fn.sorted.defaults={reverse:false,by:null,randomize:false};return k})